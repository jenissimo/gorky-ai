<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>LLM Conversation Viewer</title>
    <link rel="stylesheet" href="static/css/viewer-common.css">
    <link rel="stylesheet" href="static/css/animations.css">
    <link rel="stylesheet" href="static/css/log-viewer.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LLM Conversation Viewer</h1>
            <div class="session-info" id="sessionInfo"></div>
        </div>

        <div class="drop-zone" id="dropZone">
            <h2>Перетащите файл лога сюда</h2>
            <p>или нажмите для выбора файла</p>
            <input type="file" id="fileInput" style="display: none" accept=".json">
        </div>
        
        <div class="conversation" id="conversation">
            <div class="requests-list" id="interactionList"></div>
            <div class="content-container">
                <div class="prompt fade-in">
                    <h3>Запрос</h3>
                    <div class="content-scroll">
                        <pre id="promptContent"></pre>
                        <div class="metadata" id="promptMetadata"></div>
                    </div>
                </div>
                <div class="response fade-in">
                    <h3>Ответ</h3>
                    <div class="content-scroll">
                        <pre id="responseContent"></pre>
                        <div class="metadata" id="responseMetadata"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="static/js/file-handler.js"></script>
    <script>
        // Специфичный код для работы с логами
        const fileHandler = new FileHandler('dropZone', 'fileInput', (data) => {
            conversationData = data;
            displayConversation();
        });
        
        let conversationData = null;
        
        function displayConversation() {
            conversation.style.display = 'flex';
            interactionList.innerHTML = '';
            
            // Отображаем информацию о сессии
            const startTime = new Date(conversationData.start_time).toLocaleString();
            sessionInfo.innerHTML = `
                <strong>ID сессии:</strong> ${conversationData.session_id}<br>
                <strong>Начало:</strong> ${startTime}<br>
                <strong>Количество взаимодействий:</strong> ${conversationData.interactions.length}
            `;
            
            conversationData.interactions.forEach((interaction, index) => {
                const item = document.createElement('div');
                item.className = 'interaction-item fade-in';
                const time = new Date(interaction.timestamp).toLocaleTimeString();
                item.innerHTML = `
                    Запрос ${index + 1}
                    <div class="interaction-time">${time}</div>
                `;
                item.onclick = () => displayInteraction(interaction, item);
                interactionList.appendChild(item);
            });
            
            if (conversationData.interactions.length > 0) {
                displayInteraction(conversationData.interactions[0], interactionList.firstChild);
            }
        }
        
        function displayInteraction(interaction, element) {
            // Подсвечиваем выбранный элемент
            document.querySelectorAll('.interaction-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // Отображаем данные взаимодействия
            promptContent.textContent = interaction.prompt;
            
            // Форматируем ответ в зависимости от типа
            if (interaction.response_type === 'dict' || interaction.response_type === 'list') {
                responseContent.textContent = JSON.stringify(interaction.response, null, 2);
            } else {
                responseContent.textContent = interaction.response;
            }
            
            // Отображаем метаданные
            const time = new Date(interaction.timestamp).toLocaleString();
            promptMetadata.innerHTML = `
                <div class="metadata-item">
                    <span class="metadata-label">Время:</span>
                    <span class="metadata-value">${time}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Сервис:</span>
                    <span class="metadata-value">${interaction.service}</span>
                </div>
            `;
            
            responseMetadata.innerHTML = `
                <div class="metadata-item">
                    <span class="metadata-label">Тип ответа:</span>
                    <span class="metadata-value">${interaction.response_type}</span>
                </div>
            `;
            
            if (interaction.metadata) {
                Object.entries(interaction.metadata).forEach(([key, value]) => {
                    responseMetadata.innerHTML += `
                        <div class="metadata-item">
                            <span class="metadata-label">${key}:</span>
                            <span class="metadata-value">${JSON.stringify(value)}</span>
                        </div>
                    `;
                });
            }
        }
    </script>
</body>
</html> 